<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KodNest Premium Build System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- TOP BAR -->
    <header class="top-bar">
        <div class="brand-name" style="font-family: var(--font-serif); font-weight: 700; font-size: 1.2rem;">Job
            Notification Tracker</div>

        <button class="menu-toggle" id="menu-toggle">
            <i class="fas fa-bars"></i>
        </button>

        <nav class="nav-links" id="nav-links">
            <li><a href="#/" class="nav-link" data-route="home">Home</a></li>
            <li><a href="#/dashboard" class="nav-link" data-route="dashboard">Dashboard</a></li>
            <li><a href="#/saved" class="nav-link" data-route="saved">Saved</a></li>
            <li><a href="#/digest" class="nav-link" data-route="digest">Digest</a></li>
            <li><a href="#/settings" class="nav-link" data-route="settings">Settings</a></li>
            <li><a href="#/jt/proof" class="nav-link" data-route="jt-proof">Proof</a></li>
            <li><a href="#/jt/07-test" class="nav-link" data-route="jt-07-test">Test Checklist</a></li>
            <li><a href="#/jt/08-ship" class="nav-link" data-route="jt-08-ship">Ship</a></li>
        </nav>
    </header>

    <div class="layout-container">
        <main class="workspace" id="app-container">

            <!-- HOME PAGE (Landing) -->
            <section id="page-home" class="page-section active">
                <div class="hero">
                    <h1>Stop Missing The Right Jobs.</h1>
                    <p class="subtext">Precision-matched job discovery delivered daily at 9AM.</p>
                    <a href="#/settings" class="btn btn-primary" style="padding: 16px 40px; font-size: 18px;">Start
                        Tracking</a>
                </div>
            </section>

            <!-- DASHBOARD PAGE -->
            <section id="page-dashboard" class="page-section">
                <div class="context-header">
                    <h1>Opportunity Dashboard</h1>
                    <p class="subtext">Real-time discoverability across the Indian tech ecosystem.</p>
                </div>

                <!-- FILTER BAR -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <input type="text" id="filter-keyword" class="form-control"
                            placeholder="Search title or company..." oninput="updateUI()">
                    </div>
                    <div class="filter-group">
                        <select id="filter-status" class="form-control" onchange="updateUI()">
                            <option value="all">Any Status</option>
                            <option value="Not Applied">Not Applied</option>
                            <option value="Applied">Applied</option>
                            <option value="Rejected">Rejected</option>
                            <option value="Selected">Selected</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="filter-location" class="form-control" onchange="updateUI()">
                            <option value="all">All Locations</option>
                            <option value="remote">Remote</option>
                            <option value="bangalore">Bangalore</option>
                            <option value="mumbai">Mumbai</option>
                            <option value="pune">Pune</option>
                            <option value="hyderabad">Hyderabad</option>
                            <option value="chennai">Chennai</option>
                            <option value="gurgaon">Gurgaon/NCR</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="filter-experience" class="form-control" onchange="updateUI()">
                            <option value="all">Any Experience</option>
                            <option value="Fresher">Fresher</option>
                            <option value="0-1">0-1 Year</option>
                            <option value="1-3">1-3 Years</option>
                            <option value="3-5">3-5 Years</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="filter-mode" class="form-control" onchange="updateUI()">
                            <option value="all">Any Mode</option>
                            <option value="Remote">Remote</option>
                            <option value="Hybrid">Hybrid</option>
                            <option value="Onsite">Onsite</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="filter-source" class="form-control" onchange="updateUI()">
                            <option value="all">Any Source</option>
                            <option value="LinkedIn">LinkedIn</option>
                            <option value="Naukri">Naukri</option>
                            <option value="Indeed">Indeed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="filter-sort" class="form-control" onchange="updateUI()">
                            <option value="latest">Sort: Newest First</option>
                            <option value="score">Sort: Match Score</option>
                            <option value="salary">Sort: Highest Pay</option>
                        </select>
                    </div>
                    <div class="filter-group" style="display: flex; align-items: center; gap: 8px;">
                        <label class="text-small" style="font-weight: 600; white-space: nowrap;">Precision Match</label>
                        <div class="switch">
                            <input type="checkbox" id="toggle-matches" onchange="updateUI()">
                        </div>
                    </div>
                </div>

                <div id="pref-banner-container"></div>

                <div class="job-grid" id="job-list">
                    <!-- Dynamic Grid Content -->
                </div>

                <div id="toast-container"></div>
            </section>

            <!-- SAVED PAGE -->
            <section id="page-saved" class="page-section">
                <!-- Initial content, will be overwritten by updateUI() if active -->
                <div class="job-grid"></div>
            </section>

            <!-- DIGEST PAGE -->
            <section id="page-digest" class="page-section">
                <div class="context-header">
                    <h1>Daily Digest</h1>
                    <p class="subtext">Your curated morning briefing of high-relevance roles.</p>
                </div>

                <div id="digest-blocked" style="display: none;">
                    <div class="empty-state">
                        <i class="fas fa-lock"></i>
                        <h2>Preferences Protected.</h2>
                        <p>Set your job preferences to activate the intelligent digest engine.</p>
                        <a href="#/settings" class="btn btn-primary" style="margin-top: 16px;">Set Preferences</a>
                    </div>
                </div>

                <div id="digest-ready" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 300px; gap: 24px; align-items: start;">
                        <div>
                            <div class="digest-actions">
                                <button class="btn btn-primary" onclick="generateDigest()">
                                    <i class="fas fa-sync-alt"></i> Generate Today's 9AM Digest (Simulated)
                                </button>
                                <button class="btn" id="copy-digest-btn" onclick="copyDigest()"
                                    style="border: 1px solid var(--color-border); display: none;">
                                    <i class="far fa-copy"></i> Copy
                                </button>
                                <button class="btn" id="email-digest-btn" onclick="emailDigest()"
                                    style="border: 1px solid var(--color-border); display: none;">
                                    <i class="far fa-envelope"></i> Email
                                </button>
                            </div>

                            <div id="digest-container">
                                <div class="empty-state">
                                    <i class="fas fa-coffee"></i>
                                    <h2>Ready for your briefing?</h2>
                                    <p>Curate today's top matches into an email-style layout.</p>
                                </div>
                            </div>
                            <div class="demo-note">Demo Mode: Daily 9AM trigger simulated manually.</div>
                        </div>

                        <div class="card" style="margin: 0;">
                            <h3 style="margin-bottom: 16px; font-family: var(--font-display);">Recent Status Updates
                            </h3>
                            <div id="recent-status-updates">
                                <p class="text-small" style="color: var(--color-text-muted)">No recent activity tracked.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SETTINGS PAGE -->
            <section id="page-settings" class="page-section">
                <!-- Dashboard Header -->
                <div class="context-header">
                    <div
                        style="display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 16px;">
                        <div>
                            <h1>Preferences & Matching</h1>
                            <p class="subtext">Define your ideal career path to calibrate the discovery engine.</p>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-bottom: var(--space-4);">
                    <div class="settings-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label class="input-label">Role Keywords</label>
                            <input type="text" id="pref-role-keywords" class="form-control"
                                placeholder="e.g. Frontend, React, SDE Intern (comma separated)">
                        </div>

                        <div class="form-group">
                            <label class="input-label">Preferred Locations (Cmd/Ctrl + Click)</label>
                            <select id="pref-locations" class="form-control" multiple>
                                <option value="Remote">Remote</option>
                                <option value="Bangalore">Bangalore</option>
                                <option value="Mumbai">Mumbai</option>
                                <option value="Pune">Pune</option>
                                <option value="Hyderabad">Hyderabad</option>
                                <option value="Chennai">Chennai</option>
                                <option value="Gurgaon">Gurgaon/NCR</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="input-label">Preferred Mode</label>
                            <div class="checkbox-group">
                                <label class="checkbox-item"><input type="checkbox" name="pref-mode" value="Remote">
                                    Remote</label>
                                <label class="checkbox-item"><input type="checkbox" name="pref-mode" value="Hybrid">
                                    Hybrid</label>
                                <label class="checkbox-item"><input type="checkbox" name="pref-mode" value="Onsite">
                                    Onsite</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="input-label">Experience Level</label>
                            <select id="pref-experience" class="form-control">
                                <option value="any">Any Level</option>
                                <option value="Fresher">Fresher</option>
                                <option value="0-1">0-1 Year</option>
                                <option value="1-3">1-3 Years</option>
                                <option value="3-5">3-5 Years</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="input-label">Skills</label>
                            <input type="text" id="pref-skills" class="form-control"
                                placeholder="e.g. Java, Python, React (comma separated)">
                        </div>

                        <div class="form-group" style="grid-column: 1 / -1;">
                            <div class="range-wrap">
                                <div class="range-header">
                                    <label class="input-label">Minimum Match Score Threshold</label>
                                    <span id="threshold-val"
                                        style="font-weight: 700; color: var(--color-accent);">40%</span>
                                </div>
                                <input type="range" id="pref-threshold" min="0" max="100" value="40"
                                    oninput="document.getElementById('threshold-val').innerText = this.value + '%'">
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: var(--space-3);">
                        <button class="btn btn-primary" onclick="savePreferences()">Update Preferences</button>
                    </div>
                </div>
            </section>

            <!-- PROOF PAGE -->
            <section id="page-jt-proof" class="page-section">
                <div class="context-header">
                    <h1>Proof of Work</h1>
                    <p class="subtext">System integrity report and project documentation.</p>
                </div>
                <div id="proof-root"></div>
            </section>

            <!-- TEST CHECKLIST PAGE -->
            <section id="page-jt-07-test" class="page-section">
                <div class="context-header">
                    <h1>System Quality Assurance</h1>
                    <p class="subtext">Verify all core functionalities before final deployment.</p>
                </div>
                <div id="checklist-root"></div>
            </section>

            <!-- SHIP PAGE -->
            <section id="page-jt-08-ship" class="page-section">
                <div id="ship-root"></div>
            </section>

        </main>
    </div>

    <!-- JOB DETAIL MODAL -->
    <div id="job-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modal-body">
                <!-- Dynamic Content -->
            </div>
        </div>
    </div>

    <script>
        // --- DATASET (60 Realistic Indian Tech Jobs) ---
        const ALL_JOBS = [
            { id: 1, title: "SDE Intern", company: "Amazon", location: "Bangalore", mode: "Onsite", experience: "Fresher", skills: ["Java", "Data Structures", "AWS"], source: "LinkedIn", postedDaysAgo: 2, salaryRange: "₹40k/month Internship", description: "Join our core services team to help build high-scale distributed systems. You will work alongside senior engineers on production-ready features.", applyUrl: "https://amazon.jobs/intern" },
            { id: 2, title: "Graduate Engineer Trainee", company: "TCS", location: "Mumbai", mode: "Hybrid", experience: "Fresher", skills: ["SQL", "C++", "Agile"], source: "Naukri", postedDaysAgo: 5, salaryRange: "3.5–5 LPA", description: "Standard induction program for recent graduates. You'll be rotated through various domains including BFSI and Retail technology units.", applyUrl: "https://tcs.com/careers" },
            { id: 3, title: "Junior Backend Developer", company: "Razorpay", location: "Bangalore", mode: "Remote", experience: "0-1", skills: ["Node.js", "MongoDB", "Redis"], source: "LinkedIn", postedDaysAgo: 1, salaryRange: "12–18 LPA", description: "Work on our payments gateway orchestration layer. Great opportunity for someone who enjoys high-concurrency problems and fintech.", applyUrl: "https://razorpay.com/jobs" },
            { id: 4, title: "Frontend Intern", company: "Swiggy", location: "Bangalore", mode: "Onsite", experience: "Fresher", skills: ["React", "CSS", "UI/UX"], source: "Indeed", postedDaysAgo: 0, salaryRange: "₹25k–₹35k/month Internship", description: "Collaborate with our design team to refine the delivery tracking interface. Expect high-impact work seen by millions of users daily.", applyUrl: "https://swiggy.com/careers" },
            { id: 5, title: "React Developer", company: "Freshworks", location: "Chennai", mode: "Hybrid", experience: "1-3", skills: ["React", "Redux", "TypeScript"], source: "LinkedIn", postedDaysAgo: 3, salaryRange: "8–14 LPA", description: "Help us build the next generation of SaaS support tools. Focus on building reusable components and optimizing frontend performance.", applyUrl: "https://freshworks.com/apply" },
            { id: 6, title: "Python Developer", company: "Zoho", location: "Chennai", mode: "Onsite", experience: "Fresher", skills: ["Python", "Django", "PostgreSQL"], source: "Naukri", postedDaysAgo: 7, salaryRange: "6–9 LPA", description: "Core backend development for our CRM tools. You will be responsible for creating robust APIs and maintaining database efficiency.", applyUrl: "https://zoho.com/careers" },
            { id: 7, title: "QA Intern", company: "Flipkart", location: "Bangalore", mode: "Hybrid", experience: "Fresher", skills: ["Selenium", "Java", "Testing"], source: "LinkedIn", postedDaysAgo: 4, salaryRange: "₹20k/month Internship", description: "Part of the supply chain quality assurance team. You will write automated test scripts and perform exploratory testing on our logistics apps.", applyUrl: "https://flipkart.com/jobs" },
            { id: 8, title: "Data Analyst Intern", company: "PhonePe", location: "Bangalore", mode: "Remote", experience: "Fresher", skills: ["Excel", "SQL", "Tableau"], source: "LinkedIn", postedDaysAgo: 2, salaryRange: "₹30k/month Internship", description: "Analyze user transaction patterns to identify market trends. You will prepare weekly reports for the growth and strategy teams.", applyUrl: "https://phonepe.com/careers" },
            { id: 9, title: "Java Developer", company: "Infosys", location: "Pune", mode: "Hybrid", experience: "0-1", skills: ["Java", "Spring Boot", "Microservices"], source: "Naukri", postedDaysAgo: 8, salaryRange: "4–6 LPA", description: "Provide maintenance and support for international banking clients. Adherence to strict coding standards and agile processes is required.", applyUrl: "https://infosys.com/careers" },
            { id: 10, title: "SDE-1", company: "CRED", location: "Bangalore", mode: "Onsite", experience: "1-3", skills: ["Node.js", "React", "Kafka"], source: "LinkedIn", postedDaysAgo: 1, salaryRange: "20–35 LPA", description: "Build premium financial experiences for high-trust individuals. High-velocity environment with extreme focus on design and performance.", applyUrl: "https://cred.club/careers" },
            { id: 11, title: "Junior Web Developer", company: "Paytm", location: "Gurgaon", mode: "Hybrid", experience: "0-1", skills: ["HTML", "Sass", "JavaScript"], source: "Indeed", postedDaysAgo: 6, salaryRange: "7–11 LPA", description: "Develop interactive web portals for merchant services. Ensure cross-browser compatibility and responsiveness across all devices.", applyUrl: "https://paytm.com/jobs" },
            { id: 12, title: "Cloud Engineer", company: "Accenture", location: "Hyderabad", mode: "Remote", experience: "1-3", skills: ["Azure", "Terraform", "DevOps"], source: "LinkedIn", postedDaysAgo: 5, salaryRange: "9–15 LPA", description: "Consult with global clients on their cloud migration strategies. Implement infrastructure as code and CI/CD pipelines.", applyUrl: "https://accenture.com/careers" },
            { id: 13, title: "Full Stack Intern", company: "Juspay", location: "Bangalore", mode: "Remote", experience: "Fresher", skills: ["Functional Programming", "Haskell", "PureScript"], source: "Indeed", postedDaysAgo: 2, salaryRange: "₹40k/month Internship", description: "Deep dive into functional programming for payments infrastructure. You will work on highly secure and optimized payment SDKs.", applyUrl: "https://juspay.in/careers" },
            { id: 14, title: "Backend Developer", company: "Capgemini", location: "Pune", mode: "Hybrid", experience: "1-3", skills: ["Java", "Oracle", "Hibernate"], source: "Naukri", postedDaysAgo: 10, salaryRange: "6–10 LPA", description: "Maintain legacy systems for European automotive clients. Modernize database queries and optimize server-side logic.", applyUrl: "https://capgemini.com/careers" },
            { id: 15, title: "ML Intern", company: "IBM", location: "Hyderabad", mode: "Onsite", experience: "Fresher", skills: ["Python", "Tensorflow", "R"], source: "LinkedIn", postedDaysAgo: 3, salaryRange: "₹35k/month Internship", description: "Work on Watson-inspired cognitive models for healthcare research. Fine-tune existing datasets and assist in model evaluation.", applyUrl: "https://ibm.com/jobs" },
            { id: 16, title: "React Developer", company: "Dell", location: "Bangalore", mode: "Hybrid", experience: "3-5", skills: ["React", "MobX", "Storybook"], source: "Indeed", postedDaysAgo: 6, salaryRange: "15–22 LPA", description: "Lead the frontend transformation of internal enterprise tools. Enforce accessibility standards and mentor junior developers.", applyUrl: "https://dell.com/careers" },
            { id: 17, title: "SDE-2", company: "Zomato", location: "Gurgaon", mode: "Onsite", experience: "3-5", skills: ["Go", "Kubernetes", "Redis"], source: "LinkedIn", postedDaysAgo: 1, salaryRange: "25–40 LPA", description: "Optimize the order fulfillment engine for peak hour spikes. Monitor system health and troubleshoot bottlenecks in real-time.", applyUrl: "https://zomato.com/careers" },
            { id: 18, title: "Systems Engineer", company: "Wipro", location: "Chennai", mode: "Onsite", experience: "0-1", skills: ["Linux", "Scripting", "NetApp"], source: "Naukri", postedDaysAgo: 9, salaryRange: "3.5–4.5 LPA", description: "Network administration and system maintenance for internal data centers. Ensure 99.9% uptime and handle ticket escalations.", applyUrl: "https://wipro.com/careers" },
            { id: 19, title: "UI Developer", company: "Cognizant", location: "Kolkata", mode: "Hybrid", experience: "1-3", skills: ["CSS3", "Angular", "Bootstrap"], source: "LinkedIn", postedDaysAgo: 7, salaryRange: "5–8 LPA", description: "Build scalable web components for insurance domain portals. Collaborate with UI designers to ensure high-fidelity implementation.", applyUrl: "https://cognizant.com/careers" },
            { id: 20, title: "App Developer", company: "Oracle", location: "Bangalore", mode: "Onsite", experience: "1-3", skills: ["Java", "PL/SQL", "APEX"], source: "LinkedIn", postedDaysAgo: 4, salaryRange: "14–20 LPA", description: "Develop and extend suite applications using Oracle proprietary technologies. Focus on high-availability and extreme performance.", applyUrl: "https://oracle.com/jobs" },
            { id: 21, title: "Backend Engineer", company: "SAP", location: "Bangalore", mode: "Hybrid", experience: "3-5", skills: ["Java", "HanaDB", "Spring"], source: "Indeed", postedDaysAgo: 5, salaryRange: "18–28 LPA", description: "Build cloud-native extensions for SAP S/4HANA. Focus on multi-tenancy support and secure integration patterns.", applyUrl: "https://sap.com/careers" },
            { id: 22, title: "Frontend Lead", company: "Ola", location: "Bangalore", mode: "Onsite", experience: "3-5", skills: ["React", "System Design", "Webpack"], source: "LinkedIn", postedDaysAgo: 2, salaryRange: "30–45 LPA", description: "Own the frontend architecture for our electric vehicle dashboard. Ensure seamless integration with real-time IoT data streams.", applyUrl: "https://ola.com/careers" },
            { id: 23, title: "Security Intern", company: "Zscaler", location: "Chandigarh", mode: "Remote", experience: "Fresher", skills: ["C", "Networking", "Pen-testing"], source: "LinkedIn", postedDaysAgo: 3, salaryRange: "₹45k/month Internship", description: "Learn cloud security fundamentals. You will assist the threat research team in documenting new malware patterns.", applyUrl: "https://zscaler.com/jobs" },
            { id: 24, title: "SRE-1", company: "Uber", location: "Hyderabad", mode: "Hybrid", experience: "1-3", skills: ["Python", "Go", "Observability"], source: "LinkedIn", postedDaysAgo: 1, salaryRange: "22–32 LPA", description: "Maintain the reliability of global rider services. Develop automated tooling for incident response and capacity planning.", applyUrl: "https://uber.com/careers" },
            { id: 25, title: "DevOps Intern", company: "Myntra", location: "Bangalore", mode: "Onsite", experience: "Fresher", skills: ["Docker", "Jenkins", "Ansible"], source: "Indeed", postedDaysAgo: 4, salaryRange: "₹25k/month Internship", description: "Automate deployment workflows for the e-commerce frontend team. Assist in migrating services to containerized environments.", applyUrl: "https://myntra.com/jobs" },
            { id: 26, title: "Node.js Developer", company: "Unacademy", location: "Bangalore", mode: "Remote", experience: "1-3", skills: ["Node", "Express", "Socket.io"], source: "LinkedIn", postedDaysAgo: 6, salaryRange: "12–19 LPA", description: "Build real-time collaborative tools for live teaching. Focus on reducing latency and improving socket connection stability.", applyUrl: "https://unacademy.com/careers" },
            { id: 27, title: "Android Developer", company: "PhonePe", location: "Pune", mode: "Hybrid", experience: "3-5", skills: ["Kotlin", "Jetpack Compose", "Dagger"], source: "Naukri", postedDaysAgo: 3, salaryRange: "20–30 LPA", description: "Lead the payments feature team for Android. Implement high-security merchant transaction modules and optimize app startup time.", applyUrl: "https://phonepe.com/careers" },
            { id: 28, title: "Test Engineer", company: "Wipro", location: "Bangalore", mode: "Hybrid", experience: "0-1", skills: ["API Testing", "Postman", "SQL"], source: "Naukri", postedDaysAgo: 8, salaryRange: "3.8–5 LPA", description: "Execute functional test cases for a global retail client. Coordinate with the development team for bug fixes and re-testing.", applyUrl: "https://wipro.com/careers" },
            { id: 29, title: "Data Engineer", company: "Swiggy", location: "Bangalore", mode: "Onsite", experience: "1-3", skills: ["Spark", "Airflow", "Scala"], source: "LinkedIn", postedDaysAgo: 4, salaryRange: "16–24 LPA", description: "Build scalable data pipelines for processing gigabytes of delivery logs. Optimize warehouse queries for better business insights.", applyUrl: "https://swiggy.com/jobs" },
            { id: 30, title: "Graduate Trainee", company: "HCLTech", location: "Noida", mode: "Onsite", experience: "Fresher", skills: ["Java", "Mainframe", "SDLC"], source: "Naukri", postedDaysAgo: 7, salaryRange: "3.3–4 LPA", description: "Standard training program followed by allocation to enterprise support projects. You will work on maintaining global infra systems.", applyUrl: "https://hcltech.com/careers" },
            { id: 31, title: "Junior UI Designer", company: "CRED", location: "Bangalore", mode: "Onsite", experience: "0-1", skills: ["Figma", "Prototyping", "Visual Design"], source: "LinkedIn", postedDaysAgo: 2, salaryRange: "10–15 LPA", description: "Collaborate on building a unique credit-card lifestyle interface. High focus on micro-interactions and visual storytelling.", applyUrl: "https://cred.club/careers" },
            { id: 32, title: "Python Engineer", company: "Instamojo", location: "Bangalore", mode: "Remote", experience: "1-3", skills: ["Python", "Flask", "Postgres"], source: "LinkedIn", postedDaysAgo: 5, salaryRange: "9–14 LPA", description: "Build merchant-facing payment links and simple e-commerce stores. Focus on clean code and developer-friendly APIs.", applyUrl: "https://instamojo.com/jobs" },
            { id: 33, title: "Systems Analyst", company: "Capgemini", location: "Chennai", mode: "Hybrid", experience: "3-5", skills: ["Business Analysis", "UML", "Jira"], source: "Naukri", postedDaysAgo: 9, salaryRange: "10–14 LPA", description: "Bridge the gap between business requirements and technical specs for French manufacturing clients. Moderate travel may be required.", applyUrl: "https://capgemini.com/jobs" },
            { id: 34, title: "React Native Intern", company: "Meesho", location: "Bangalore", mode: "Onsite", experience: "Fresher", skills: ["React Native", "Redux", "API"], source: "LinkedIn", postedDaysAgo: 1, salaryRange: "₹20k/month Internship", description: "Assist in building social commerce features on our mobile app. You will learn to debug cross-platform performance issues.", applyUrl: "https://meesho.io/careers" },
            { id: 35, title: "Lead Backend Developer", company: "Delhivery", location: "Gurgaon", mode: "Hybrid", experience: "3-5", skills: ["Python", "AWS", "Logistics Tech"], source: "LinkedIn", postedDaysAgo: 3, salaryRange: "28–38 LPA", description: "Architect the routing engine for millions of daily shipments. Lead a team of 4 engineers and define backend best practices.", applyUrl: "https://delhivery.com/careers" },
            { id: 36, title: "QA Analyst", company: "Qualcomm", location: "Hyderabad", mode: "Onsite", experience: "1-3", skills: ["Python", "Embedded Testing", "Perl"], source: "Indeed", postedDaysAgo: 6, salaryRange: "12–18 LPA", description: "Validate modem firmware for upcoming mobile chipsets. You will write high-level hardware abstraction tests using Python.", applyUrl: "https://qualcomm.com/jobs" },
            { id: 37, title: "Web Developer", company: "Zoho", location: "Tenkasi", mode: "Onsite", experience: "0-1", skills: ["JavaScript", "HTML5", "CSS3"], source: "LinkedIn", postedDaysAgo: 4, salaryRange: "5–8 LPA", description: "Work from our rural office in Tenkasi. You will be building consumer-facing web apps for Zoho's diverse product ecosystem.", applyUrl: "https://zoho.com/tenkasi/jobs" },
            { id: 38, title: "Software Engineer", company: "Google", location: "Bangalore", mode: "Hybrid", experience: "1-3", skills: ["C++", "Algorithms", "Scale"], source: "LinkedIn", postedDaysAgo: 1, salaryRange: "35–55 LPA", description: "Join the search infrastructure team. You will work on indexing and ranking systems that serve billions of queries world-wide.", applyUrl: "https://google.com/careers" },
            { id: 39, title: "Content QA Intern", company: "Skillshare", location: "Remote", mode: "Remote", experience: "Fresher", skills: ["English", "Content Review", "LMS"], source: "Indeed", postedDaysAgo: 10, salaryRange: "₹15k/month Internship", description: "Review educational content for clarity and technical accuracy. Ensure all course materials meet Skillshare's production values.", applyUrl: "https://skillshare.com/careers" },
            { id: 40, title: "Site Reliability Engineer", company: "Microsoft", location: "Hyderabad", mode: "Hybrid", experience: "3-5", skills: ["Azure", "Kubernetes", "C#"], source: "LinkedIn", postedDaysAgo: 3, salaryRange: "25–38 LPA", description: "Ensure the availability and performance of Microsoft Teams infrastructure. Focus on automation and auto-scaling logic.", applyUrl: "https://microsoft.com/jobs" },
            { id: 41, title: "Front-end Specialist", company: "Smallcase", location: "Bangalore", mode: "Hybrid", experience: "1-3", skills: ["React", "D3.js", "Finance UI"], source: "LinkedIn", postedDaysAgo: 5, salaryRange: "14–22 LPA", description: "Design and implement complex financial charts and portfolio management views. High focus on data visualization and responsiveness.", applyUrl: "https://smallcase.com/careers" },
            { id: 42, title: "SDE-1", company: "CoinSwitch", location: "Bangalore", mode: "Remote", experience: "1-3", skills: ["Go", "Crypto", "Microservices"], source: "LinkedIn", postedDaysAgo: 2, salaryRange: "18–26 LPA", description: "Develop high-throughput crypto-trading engines. You will be responsible for security-first backend development and API design.", applyUrl: "https://coinswitch.co/jobs" },
            { id: 43, title: "ML Engineer", company: "Nvidia", location: "Pune", mode: "Onsite", experience: "3-5", skills: ["CUDA", "C++", "PyTorch"], source: "LinkedIn", postedDaysAgo: 4, salaryRange: "30–50 LPA", description: "Optimize deep learning frameworks for specialized GPU architectures. Work on cutting-edge computer vision and AI models.", applyUrl: "https://nvidia.com/careers" },
            { id: 44, title: "Associate Software Engineer", company: "Optum", location: "Gurgaon", mode: "Onsite", experience: "0-1", skills: ["Java", "Spring Boot", "Health IT"], source: "Naukri", postedDaysAgo: 8, salaryRange: "8–12 LPA", description: "Contribute to building healthcare management systems for US-based clients. Adhere to HIPAA standards and secure data handling.", applyUrl: "https://optum.com/jobs" },
            { id: 45, title: "Cloud Support Intern", company: "AWS", location: "Bangalore", mode: "Remote", experience: "Fresher", skills: ["Linux", "Networking", "IAM"], source: "LinkedIn", postedDaysAgo: 2, salaryRange: "₹30k/month Internship", description: "Learn to troubleshoot complex cloud infrastructure issues. Assist global customers in configuring secure AWS environments.", applyUrl: "https://amazon.jobs/intern-aws" },
            { id: 46, title: "Full Stack Dev", company: "Zerodha", location: "Bangalore", mode: "Remote", experience: "1-3", skills: ["Go", "React", "Linux"], source: "LinkedIn", postedDaysAgo: 1, salaryRange: "20–30 LPA", description: "Work on India's largest trading platform. We value independent problem solvers who can ship clean, minimal, and fast code.", applyUrl: "https://zerodha.tech/careers" },
            { id: 47, title: "Systems Engineer Trainee", company: "Infosys", location: "Mysore", mode: "Onsite", experience: "Fresher", skills: ["Java", "SQL", "Communication"], source: "Naukri", postedDaysAgo: 9, salaryRange: "3.6 LPA", description: "Attend the world-renowned Infosys Global Education Center for rigorous software foundation training before project deployment.", applyUrl: "https://infosys.com/mysore" },
            { id: 48, title: "Data Analyst", company: "Oyo", location: "Gurgaon", mode: "Hybrid", experience: "1-3", skills: ["Python", "SQL", "Excel"], source: "Indeed", postedDaysAgo: 6, salaryRange: "8–14 LPA", description: "Use data to optimize dynamic pricing for Oyo rooms worldwide. You will collaborate with the revenue and growth teams.", applyUrl: "https://oyo.com/jobs" },
            { id: 49, title: "iOS Developer", company: "CRED", location: "Bangalore", mode: "Onsite", experience: "3-5", skills: ["Swift", "Combine", "UIKIt"], source: "LinkedIn", postedDaysAgo: 3, salaryRange: "25–40 LPA", description: "Help build the most visually stunning iOS app in India. We emphasize pixel-perfect UI and buttery-smooth animations.", applyUrl: "https://cred.club/careers/ios" },
            { id: 50, title: "Java Developer", company: "Morgan Stanley", location: "Mumbai", mode: "Hybrid", experience: "1-3", skills: ["Java", "Multithreading", "Algorithms"], source: "LinkedIn", postedDaysAgo: 5, salaryRange: "18–28 LPA", description: "Develop high-frequency trading platforms for institutional global clients. Proficiency in low-latency Java is highly desired.", applyUrl: "https://morganstanley.com/careers" },
            { id: 51, title: "Frontend Intern", company: "Razorpay", location: "Remote", mode: "Remote", experience: "Fresher", skills: ["JavaScript", "HTML", "Sass"], source: "LinkedIn", postedDaysAgo: 2, salaryRange: "₹30k/month Internship", description: "Help build the future of money in India. Ideal for interns who are obsessed with detail and high-quality web experiences.", applyUrl: "https://razorpay.com/interns" },
            { id: 52, title: "SDE-1", company: "Blinkit", location: "Gurgaon", mode: "Onsite", experience: "1-3", skills: ["Node.js", "Redis", "ElasticSearch"], source: "LinkedIn", postedDaysAgo: 1, salaryRange: "15–20 LPA", description: "Optimize the 10-minute delivery engine. You'll work on real-time inventory management and rider assignment algorithms.", applyUrl: "https://blinkit.com/careers" },
            { id: 53, title: "Junior Python Dev", company: "LTI Mindtree", location: "Bangalore", mode: "Hybrid", experience: "Fresher", skills: ["Python", "Flask", "Docker"], source: "Naukri", postedDaysAgo: 7, salaryRange: "4–6.5 LPA", description: "Standard associate role working on enterprise application development. You'll be part of the R&D division for energy vertical.", applyUrl: "https://ltimindtree.com/careers" },
            { id: 54, title: "Security Analyst", company: "Palo Alto", location: "Bangalore", mode: "Hybrid", experience: "1-3", skills: ["SIEM", "Splunk", "Linux"], source: "LinkedIn", postedDaysAgo: 4, salaryRange: "14–20 LPA", description: "Monitor and respond to security threats across global infrastructure. High focus on log analysis and threat intelligence.", applyUrl: "https://paloalto.com/jobs" },
            { id: 55, title: "Full Stack Engineer", company: "Groww", location: "Bangalore", mode: "Onsite", experience: "1-3", skills: ["Java", "React", "Kafka"], source: "LinkedIn", postedDaysAgo: 3, salaryRange: "18–28 LPA", description: "Build scalable investment platforms for the masses. You will develop backend microservices and responsive frontend views.", applyUrl: "https://groww.in/careers" },
            { id: 56, title: "Backend Intern", company: "Inmobi", location: "Bangalore", mode: "Onsite", experience: "Fresher", skills: ["Go", "SQL", "Spark"], source: "Indeed", postedDaysAgo: 2, salaryRange: "₹25k/month Internship", description: "Join our ad-tech platform team. You will assist in processing petabytes of advertisement data for global targeting.", applyUrl: "https://inmobi.com/jobs" },
            { id: 57, title: "React Developer", company: "Postman", location: "Bangalore", mode: "Remote", experience: "3-5", skills: ["React", "Electron", "Testing"], source: "LinkedIn", postedDaysAgo: 5, salaryRange: "25–45 LPA", description: "Improve the developer experience of the world's most popular API client. Focus on performance and complex desktop-hybrid UI.", applyUrl: "https://postman.com/careers" },
            { id: 58, title: "Systems Engineer", company: "TCS", location: "Noida", mode: "Onsite", experience: "0-1", skills: ["SQL", "PL/SQL", "Linux"], source: "Naukri", postedDaysAgo: 10, salaryRange: "3.5–4.5 LPA", description: "Handle support and maintenance for a major US-based airlines client. Ensure system stability and handle patch deployments.", applyUrl: "https://tcs.com/jobs/noida" },
            { id: 59, title: "QA Intern", company: "Accenture", location: "Bangalore", mode: "Hybrid", experience: "Fresher", skills: ["API Testing", "Manual Testing"], source: "Indeed", postedDaysAgo: 4, salaryRange: "₹18k/month Internship", description: "Execute test scripts for a hospitality client. Identify regressions and work closely with the dev team for faster delivery.", applyUrl: "https://accenture.com/careers/qa" },
            { id: 60, title: "Data Scientist", company: "Target", location: "Bangalore", mode: "Onsite", experience: "3-5", skills: ["Python", "PySpark", "Data Viz"], source: "LinkedIn", postedDaysAgo: 6, salaryRange: "20–35 LPA", description: "Use advanced analytics to predict retail demand. Collaborate with global stakeholders to refine supply chain efficiency.", applyUrl: "https://target.com/jobs/data" }
        ];

        let state = {
            preferences: JSON.parse(localStorage.getItem('jobTrackerPreferences')) || null,
            savedJobIds: JSON.parse(localStorage.getItem('savedJobIds')) || [],
            jobStatus: JSON.parse(localStorage.getItem('jobTrackerStatus')) || {},
            statusHistory: JSON.parse(localStorage.getItem('jobTrackerStatusHistory')) || [],
            testChecks: JSON.parse(localStorage.getItem('jobTrackerTestChecks')) || Array(10).fill(false),
            artifacts: JSON.parse(localStorage.getItem('jobTrackerArtifacts')) || { lovable: '', github: '', live: '' }
        };

        const getPassCount = () => state.testChecks.filter(c => c).length;
        const validateUrl = (url) => /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(url);

        const getProjectStatus = () => {
            const hasLinks = state.artifacts.lovable && state.artifacts.github && state.artifacts.live;
            const testsPassed = getPassCount() === 10;
            if (hasLinks && testsPassed) return 'Shipped';
            if (hasLinks || testsPassed || state.preferences) return 'In Progress';
            return 'Not Started';
        };

        // --- MATCH SCORING ENGINE ---
        function calculateMatchScore(job, prefs) {
            if (!prefs) return 0;
            let score = 0;

            // 1. roleKeywords in job.title (+25)
            const roleKeywords = prefs.roleKeywords.toLowerCase().split(',').map(k => k.trim()).filter(k => k);
            if (roleKeywords.some(k => job.title.toLowerCase().includes(k))) {
                score += 25;
            }

            // 2. roleKeywords in job.description (+15)
            if (roleKeywords.some(k => job.description.toLowerCase().includes(k))) {
                score += 15;
            }

            // 3. location match (+15)
            const prefLocs = Array.isArray(prefs.preferredLocations) ? prefs.preferredLocations : [];
            if (prefLocs.some(l => job.location.toLowerCase() === l.toLowerCase())) {
                score += 15;
            }

            // 4. mode match (+10)
            const prefModes = Array.isArray(prefs.preferredMode) ? prefs.preferredMode : [];
            if (prefModes.some(m => job.mode.toLowerCase() === m.toLowerCase())) {
                score += 10;
            }

            // 5. experience match (+10)
            if (prefs.experienceLevel === "any" || job.experience === prefs.experienceLevel) {
                score += 10;
            }

            // 6. skills overlap (+15)
            const userSkills = prefs.skills.toLowerCase().split(',').map(s => s.trim()).filter(s => s);
            const jobSkills = job.skills.map(s => s.toLowerCase());
            if (userSkills.some(us => jobSkills.includes(us))) {
                score += 15;
            }

            // 7. postedDaysAgo <= 2 (+5)
            if (job.postedDaysAgo <= 2) {
                score += 5;
            }

            // 8. source is LinkedIn (+5)
            if (job.source === "LinkedIn") {
                score += 5;
            }

            return Math.min(score, 100);
        }

        function getScoreBadgeClass(score) {
            if (score >= 80) return 'score-high';
            if (score >= 60) return 'score-amber';
            if (score >= 40) return 'score-neutral';
            return 'score-low';
        }

        function getStatusBadgeClass(status) {
            if (status === "Applied") return 'status-applied';
            if (status === "Rejected") return 'status-rejected';
            if (status === "Selected") return 'status-selected';
            return 'status-neutral';
        }

        // --- CORE LOGIC ---
        function getFilteredJobs() {
            const keyword = document.getElementById('filter-keyword').value.toLowerCase();
            const location = document.getElementById('filter-location').value;
            const mode = document.getElementById('filter-mode').value;
            const experience = document.getElementById('filter-experience').value;
            const source = document.getElementById('filter-source').value;
            const sort = document.getElementById('filter-sort').value;
            const statusFilter = document.getElementById('filter-status').value;
            const showOnlyMatches = document.getElementById('toggle-matches').checked;

            let jobs = ALL_JOBS.map(job => ({
                ...job,
                matchScore: calculateMatchScore(job, state.preferences),
                status: state.jobStatus[job.id] || "Not Applied"
            }));

            // Dashboard Specific Filtering
            if (showOnlyMatches && state.preferences) {
                jobs = jobs.filter(j => j.matchScore >= state.preferences.minMatchScore);
            }

            return jobs.filter(job => {
                const kwMatch = keyword === "" ||
                    job.title.toLowerCase().includes(keyword) ||
                    job.company.toLowerCase().includes(keyword);

                const locMatch = location === "all" ||
                    (location === "remote" && job.location.toLowerCase() === "remote") ||
                    job.location.toLowerCase() === location.toLowerCase();

                const modeMatch = mode === "all" || job.mode === mode;
                const expMatch = experience === "all" || job.experience === experience;
                const sourceMatch = source === "all" || job.source === source;
                const statusMatch = statusFilter === "all" || job.status === statusFilter;

                return kwMatch && locMatch && modeMatch && expMatch && sourceMatch && statusMatch;
            }).sort((a, b) => {
                if (sort === "latest") return a.postedDaysAgo - b.postedDaysAgo;
                if (sort === "score") return b.matchScore - a.matchScore;
                if (sort === "salary") {
                    return getVal(b.salaryRange) - getVal(a.salaryRange);
                }
                return b.postedDaysAgo - a.postedDaysAgo;
            });
        }

        // --- UI RENDERING ---
        function renderJobCard(job) {
            const isSaved = state.savedJobIds.includes(job.id);
            const sourceClass = `badge-${job.source.toLowerCase()}`;
            const scoreClass = getScoreBadgeClass(job.matchScore);
            const statusClass = getStatusBadgeClass(job.status || "Not Applied");

            return `
                <div class="job-card ${isSaved ? 'saved' : ''}">
                    <div>
                        <div class="job-header">
                            <span class="job-company">${job.company}</span>
                            <div style="display: flex; gap: 8px;">
                                <span class="badge ${statusClass}" style="font-size: 10px; padding: 2px 8px;">${job.status || "Not Applied"}</span>
                                ${state.preferences ? `<span class="badge-score ${scoreClass}">${job.matchScore}% Match</span>` : ''}
                                <span class="badge ${sourceClass} badge-source">${job.source}</span>
                            </div>
                        </div>
                        <h3 class="job-title">${job.title}</h3>
                        <div class="job-meta">
                            <span><i class="fas fa-map-marker-alt"></i> ${job.location}</span>
                            <span><i class="fas fa-laptop-house"></i> ${job.mode}</span>
                            <span><i class="fas fa-signal"></i> ${job.experience}</span>
                        </div>
                        <div class="salary-highlight">${job.salaryRange}</div>
                    </div>
                    <div class="job-actions">
                        <div style="display: flex; flex-direction: column; gap: 8px; align-items: flex-end;">
                            <span class="text-small" style="color: var(--color-text-muted)">${job.postedDaysAgo === 0 ? 'Today' : job.postedDaysAgo + ' days ago'}</span>
                            <select class="status-select" onchange="updateJobStatus(${job.id}, this.value)">
                                <option value="Not Applied" ${job.status === 'Not Applied' ? 'selected' : ''}>Not Applied</option>
                                <option value="Applied" ${job.status === 'Applied' ? 'selected' : ''}>Applied</option>
                                <option value="Rejected" ${job.status === 'Rejected' ? 'selected' : ''}>Rejected</option>
                                <option value="Selected" ${job.status === 'Selected' ? 'selected' : ''}>Selected</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;" onclick="viewJob(${job.id})">View</button>
                            <a href="${job.applyUrl}" target="_blank" class="btn" style="padding: 6px 12px; font-size: 12px; border: 1px solid var(--color-border);">Apply</a>
                            <button class="btn-save ${isSaved ? 'active' : ''}" onclick="toggleSave(${job.id})">
                                <i class="${isSaved ? 'fas' : 'far'} fa-bookmark"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateUI() {
            const filteredJobs = getFilteredJobs();

            // Preference Banner Handling
            const bannerContainer = document.getElementById('pref-banner-container');
            if (bannerContainer) {
                if (!state.preferences) {
                    bannerContainer.innerHTML = `
                        <div class="alert-banner">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Matching inactive.</strong>
                                <a href="#/settings" style="color: var(--color-accent); text-decoration: underline; margin-left: 8px;">Set your preferences</a> to activate intelligent matching.
                            </div>
                        </div>
                    `;
                } else {
                    bannerContainer.innerHTML = '';
                }
            }

            // Digest Section Visibility
            const digestBlocked = document.getElementById('digest-blocked');
            const digestReady = document.getElementById('digest-ready');
            if (digestBlocked && digestReady) {
                if (!state.preferences) {
                    digestBlocked.style.display = 'block';
                    digestReady.style.display = 'none';
                } else {
                    digestBlocked.style.display = 'none';
                    digestReady.style.display = 'block';
                    loadDigestIfAvailable();
                    renderStatusHistory();
                }
            }

            // Dashboard Rendering
            const dashboardContainer = document.querySelector('#job-list');
            if (dashboardContainer) {
                if (filteredJobs.length > 0) {
                    dashboardContainer.innerHTML = filteredJobs.map(j => renderJobCard(j)).join('');
                } else {
                    const isThresholdFilter = document.getElementById('toggle-matches').checked;
                    dashboardContainer.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <i class="fas fa-search"></i>
                            <h2>${isThresholdFilter ? 'No roles match your threshold.' : 'No results found.'}</h2>
                            <p>${isThresholdFilter ? 'Adjust filters or lower your match threshold in settings.' : 'Try adjusting your filters or keyword search.'}</p>
                        </div>
                    `;
                }
            }

            // Saved Page Rendering
            const savedSectionText = document.querySelector('#page-saved');
            const savedJobs = ALL_JOBS.filter(j => state.savedJobIds.includes(j.id)).map(j => ({
                ...j, matchScore: calculateMatchScore(j, state.preferences)
            }));
            if (savedSectionText && savedSectionText.classList.contains('active')) {
                const innerGrid = savedSectionText.querySelector('.job-grid');
                if (savedJobs.length > 0) {
                    savedSectionText.innerHTML = `
                        <div class="context-header">
                            <h1>Saved Opportunities</h1>
                            <p class="subtext">Your curated shortlist of high-potential roles.</p>
                        </div>
                        <div class="job-grid">${savedJobs.map(j => renderJobCard(j)).join('')}</div>
                    `;
                } else {
                    savedSectionText.innerHTML = `
                         <div class="context-header">
                            <h1>Saved Opportunities</h1>
                            <p class="subtext">Your curated shortlist of high-potential roles.</p>
                        </div>
                        <div class="empty-state">
                            <i class="far fa-bookmark"></i>
                            <h2>Your shortlist is empty.</h2>
                            <p>Save jobs from the dashboard to review them later.</p>
                        </div>
                    `;
                }
            }

            // Digest Page (Top 3 Matches)
            const digestContainer = document.querySelector('#page-digest');
            // The digest rendering is now handled by loadDigestIfAvailable and renderDigest
            // This block will only ensure the digest page is active and then load the digest
            if (digestContainer && digestContainer.classList.contains('active')) {
                // The actual content rendering is done by loadDigestIfAvailable()
                // which is called in the "Digest Section Visibility" block above.
                // We might want to trigger generateDigest if no digest is found for today.
                const today = new Date().toISOString().split('T')[0];
                if (!localStorage.getItem(`jobTrackerDigest_${today}`)) {
                    generateDigest();
                }
            }

            // Proof Page Stats
            const proofContainer = document.querySelector('#page-proof');
            if (proofContainer && proofContainer.classList.contains('active')) {
                proofContainer.innerHTML = `
                    <div class="context-header">
                        <h1>Proof of Work</h1>
                        <p class="subtext">System integrity report and runtime statistics.</p>
                    </div>
                    <div class="proof-container">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;">
                            <div class="card" style="margin-bottom: 0;">
                                <h2 style="font-size: 48px; margin: 0;">${filteredJobs.length}</h2>
                                <p class="subtext" style="font-size: 14px;">Total Matches Found</p>
                            </div>
                            <div class="card" style="margin-bottom: 0;">
                                <h2 style="font-size: 48px; margin: 0;">${state.savedJobIds.length}</h2>
                                <p class="subtext" style="font-size: 14px;">Opportunities Saved</p>
                            </div>
                        </div>
                        <div style="margin-top: 24px; text-align: left; background: var(--color-bg); padding: 16px; border-radius: 4px; font-family: monospace; font-size: 12px;">
                            <div>[SYSTEM] Initializing matching engine... OK</div>
                            <div>[DATA] Fetched ${ALL_JOBS.length} job records.</div>
                            <div>[STATE] Settings loaded from localStorage.</div>
                            <div>[ROUTING] Current Hash: ${window.location.hash || '#/'}</div>
                        </div>
                    </div>
                `;
            }

            // Settings Sync (if settings page is active)
            const settingsPage = document.querySelector('#page-settings');
            if (settingsPage && settingsPage.classList.contains('active')) {
                // This part assumes settings are still managed by state.settings,
                // but the provided diff removed state.settings.
                // For now, I'll keep the UI sync as it was, assuming state.settings
                // might be re-introduced or managed differently.
                // If state.settings is truly removed, this part would need to be removed too.
                // For this specific instruction, I'll keep it as it was not part of the diff to remove.
                // However, the original `state` definition was replaced, so `state.settings` is undefined.
                // I will comment this out as it would cause an error.
                /*
                document.querySelector('#kw-input').value = state.settings.keywords;
                document.querySelector('#loc-input').value = state.settings.locations;
                document.querySelector('#mode-select').value = state.settings.mode;
                document.querySelector('#exp-select').value = state.settings.experience;
                */
            }
        }

        // --- DIGEST ENGINE ---
        function generateDigest() {
            if (!state.preferences) return;

            const fullList = ALL_JOBS.map(job => ({
                ...job,
                matchScore: calculateMatchScore(job, state.preferences)
            }));

            // Select Top 10: Match Score Desc, then PostedDaysAgo Asc
            const digestJobs = fullList
                .filter(job => job.matchScore > 0)
                .sort((a, b) => (b.matchScore - a.matchScore) || (a.postedDaysAgo - b.postedDaysAgo))
                .slice(0, 10);

            const container = document.getElementById('digest-container');
            if (!container) return; // Ensure container exists before trying to update it

            if (digestJobs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search-minus"></i>
                        <h2>No matching roles today.</h2>
                        <p>Check again tomorrow or broaden your preferences.</p>
                    </div>
                `;
                document.getElementById('copy-digest-btn').style.display = 'none';
                document.getElementById('email-digest-btn').style.display = 'none';
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            localStorage.setItem(`jobTrackerDigest_${today}`, JSON.stringify(digestJobs));
            renderDigest(digestJobs);
        }

        function loadDigestIfAvailable() {
            const today = new Date().toISOString().split('T')[0];
            const stored = localStorage.getItem(`jobTrackerDigest_${today}`);
            if (stored) {
                renderDigest(JSON.parse(stored));
            } else {
                // If no digest is stored for today, generate one
                generateDigest();
            }
        }

        function renderDigest(jobs) {
            const container = document.getElementById('digest-container');
            if (!container) return; // Ensure container exists
            const dateStr = new Date().toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            document.getElementById('copy-digest-btn').style.display = 'inline-block';
            document.getElementById('email-digest-btn').style.display = 'inline-block';

            container.innerHTML = `
                <div class="digest-outer">
                    <div class="digest-inner" id="digest-email-frame">
                        <div class="digest-header">
                            <div style="font-weight: 800; color: var(--color-accent); letter-spacing: 2px; text-transform: uppercase; font-size: 10px; margin-bottom: 8px;">Job Notification Tracker</div>
                            <h2 style="margin: 0; font-family: var(--font-display);">Top 10 Jobs For You</h2>
                            <div style="color: var(--color-text-muted); font-size: 14px; margin-top: 4px;">9AM Digest &bull; ${dateStr}</div>
                        </div>
                        
                        <div class="digest-body">
                            ${jobs.map(job => `
                                <div class="digest-job-item">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <div class="digest-job-title">${job.title}</div>
                                            <div class="digest-job-meta">${job.company} &bull; ${job.location} &bull; ${job.experience}</div>
                                        </div>
                                        <div class="badge-score ${getScoreBadgeClass(job.matchScore || 0)}">${job.matchScore || 0}% Match</div>
                                    </div>
                                    <a href="${job.applyUrl}" target="_blank" class="btn btn-primary" style="display: inline-block; padding: 6px 12px; font-size: 11px; margin-top: 8px; text-decoration: none;">View & Apply</a>
                                </div>
                            `).join('')}
                        </div>

                        <div class="digest-footer">
                            <p>This digest was generated based on your precision preferences for ${state.preferences.roleKeywords}.</p>
                            <div style="margin-top: 16px;">
                                <i class="fas fa-paper-plane" style="color: var(--color-accent); opacity: 0.5;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- SHARING TOOLS ---
        function copyDigest() {
            const today = new Date().toISOString().split('T')[0];
            const stored = localStorage.getItem(`jobTrackerDigest_${today}`);
            if (!stored) return;
            const jobs = JSON.parse(stored);

            let text = `Top 10 Jobs For You - 9AM Digest - ${new Date().toLocaleDateString()}\n\n`;
            jobs.forEach((j, i) => {
                text += `${i + 1}. ${j.title} @ ${j.company}\n   Score: ${j.matchScore}% | Location: ${j.location}\n   Apply: ${j.applyUrl}\n\n`;
            });
            text += "Generated by KodNest Job Tracker.";

            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('copy-digest-btn');
                const orig = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied';
                setTimeout(() => btn.innerHTML = orig, 2000);
            });
        }

        function emailDigest() {
            const today = new Date().toISOString().split('T')[0];
            const stored = localStorage.getItem(`jobTrackerDigest_${today}`);
            if (!stored) return;
            const jobs = JSON.parse(stored);

            const subject = encodeURIComponent("My 9AM Job Digest");
            let body = `Here are today's top job matches based on my preferences:\n\n`;
            jobs.forEach((j, i) => {
                body += `${i + 1}. ${j.title} at ${j.company} (${j.matchScore}% Match)\nView: ${j.applyUrl}\n\n`;
            });
            body += "\nGenerated by KodNest Job Tracker.";

            window.location.href = `mailto:?subject=${subject}&body=${encodeURIComponent(body)}`;
        }

        // --- ACTIONS ---
        function updateJobStatus(id, status) {
            const job = ALL_JOBS.find(j => j.id === id);
            if (!job) return;

            state.jobStatus[id] = status;
            localStorage.setItem('jobTrackerStatus', JSON.stringify(state.jobStatus));

            // Log History for Digest
            const historyItem = {
                jobId: id,
                jobTitle: job.title,
                company: job.company,
                status: status,
                date: new Date().toLocaleString('en-IN', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })
            };
            state.statusHistory.push(historyItem);
            // Keep only last 20 history items
            if (state.statusHistory.length > 20) state.statusHistory.shift();
            localStorage.setItem('jobTrackerStatusHistory', JSON.stringify(state.statusHistory));

            showToast(`Status updated: ${status}`);
            updateUI();
        }

        function viewJob(id) {
            const job = ALL_JOBS.find(j => j.id === id);
            const modal = document.getElementById('job-modal');
            const body = document.getElementById('modal-body');

            body.innerHTML = `
                <div class="modal-subtitle">${job.company} &bull; ${job.location}</div>
                <h1 class="modal-title">${job.title}</h1>
                <div style="margin-bottom: 24px;">
                    <span class="badge badge-match">${job.mode}</span>
                    <span class="badge" style="background: var(--color-bg)">${job.experience}</span>
                    <span class="salary-highlight" style="margin-left: 12px;">${job.salaryRange}</span>
                </div>
                
                <h4 style="margin-bottom: 8px;">Key Skills</h4>
                <div style="margin-bottom: 24px;">
                    ${job.skills.map(s => `<span class="skill-tag">${s}</span>`).join('')}
                </div>

                <h4 style="margin-bottom: 8px;">Description</h4>
                <p style="color: var(--color-text-primary); line-height: 1.6; margin-bottom: 32px;">${job.description}</p>
                
                <div style="display: flex; gap: 12px;">
                    <a href="${job.applyUrl}" target="_blank" class="btn btn-primary" style="flex: 1; text-align: center; text-decoration: none;">Apply on ${job.source}</a>
                </div>
            `;
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('job-modal').classList.remove('active');
        }
        // --- ACTIONS ---
        function savePreferences() {
            const roleKeywords = document.getElementById('pref-role-keywords').value;
            const locations = Array.from(document.getElementById('pref-locations').selectedOptions).map(o => o.value);
            const modes = Array.from(document.querySelectorAll('input[name="pref-mode"]:checked')).map(i => i.value);
            const experience = document.getElementById('pref-experience').value;
            const skills = document.getElementById('pref-skills').value;
            const threshold = parseInt(document.getElementById('pref-threshold').value);

            state.preferences = {
                roleKeywords,
                preferredLocations: locations,
                preferredMode: modes,
                experienceLevel: experience,
                skills,
                minMatchScore: threshold
            };

            localStorage.setItem('jobTrackerPreferences', JSON.stringify(state.preferences));
            updateUI();
            alert("Preferences Updated. Intelligent matching is now active.");
            window.location.hash = '#/'; // Redirect to dashboard
        }

        function prefillPreferences() {
            if (!state.preferences) return;
            const p = state.preferences;

            document.getElementById('pref-role-keywords').value = p.roleKeywords || "";

            const locSelect = document.getElementById('pref-locations');
            const locs = p.preferredLocations || [];
            Array.from(locSelect.options).forEach(opt => {
                opt.selected = locs.includes(opt.value);
            });

            document.querySelectorAll('input[name="pref-mode"]').forEach(chk => {
                chk.checked = (p.preferredMode || []).includes(chk.value);
            });

            document.getElementById('pref-experience').value = p.experienceLevel || "any";
            document.getElementById('pref-skills').value = p.skills || "";
            document.getElementById('pref-threshold').value = p.minMatchScore || 40;
            document.getElementById('threshold-val').innerText = (p.minMatchScore || 40) + "%";
        }

        function toggleSave(id) {
            const index = state.savedJobIds.indexOf(id);
            if (index > -1) {
                state.savedJobIds.splice(index, 1);
            } else {
                state.savedJobIds.push(id);
            }
            localStorage.setItem('savedJobIds', JSON.stringify(state.savedJobIds));
            updateUI();
        }

        // The saveSettings function was removed from the provided diff.
        // If it's still needed, it would need to be re-added with appropriate state management.
        // For now, I'm removing it as per the diff.
        /*
        function saveSettings() {
            state.settings = {
                keywords: document.querySelector('#kw-input').value,
                locations: document.querySelector('#loc-input').value,
                mode: document.querySelector('#mode-select').value,
                experience: document.querySelector('#exp-select').value
            };
            localStorage.setItem('jobTrackerSettings', JSON.stringify(state.settings));
            updateUI();
            alert("Preferences Updated.");
        }
        */

        // --- ROUTING ---
        function handleRouting() {
            const hash = window.location.hash || '#/';
            const activeRoute = (hash === '#/') ? 'home' : hash.replace('#/', '');

            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            const activeSection = document.getElementById(`page-${activeRoute}`);
            if (activeSection) activeSection.classList.add('active');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === hash) link.classList.add('active');
            });

            document.getElementById('nav-links').classList.remove('show');

            // Context Specific Logic
            if (activeRoute === 'settings') {
                prefillPreferences();
            }

            // Refresh UI on route change to handle saved page state
            if (activeRoute === 'jt-07-test') {
                renderChecklist();
            }
            if (activeRoute === 'jt-08-ship') {
                renderShipPage();
            }
            if (activeRoute === 'jt-proof') {
                renderProofPage();
            }

            updateUI();
        }

        // --- PROOF & SUBMISSION ENGINE ---
        function renderProofPage() {
            const root = document.getElementById('proof-root');
            if (!root) return;

            const status = getProjectStatus();
            const passCount = getPassCount();

            const steps = [
                { name: "01. Home Landing", done: true },
                { name: "02. Dashboard & Filters", done: true },
                { name: "03. Saved Job Repository", done: true },
                { name: "04. Daily Digest Engine", done: true },
                { name: "05. User Preferences", done: !!state.preferences },
                { name: "06. Status Tracking", done: Object.keys(state.jobStatus).length > 0 },
                { name: "07. Built-In Test Checklist", done: passCount === 10 },
                { name: "08. Final Ship Verification", done: status === 'Shipped' }
            ];

            root.innerHTML = `
                <div class="checklist-container">
                    <div class="card" style="margin-bottom: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <h2 style="margin: 0;">Project 1: Job Notification Tracker</h2>
                            <span class="project-status status-${status.toLowerCase().replace(' ', '-')}">
                                <i class="fas ${status === 'Shipped' ? 'fa-check-circle' : 'fa-circle-notch fa-spin'}"></i>
                                ${status}
                            </span>
                        </div>

                        <h3 style="margin-bottom: 16px;">A) Step Completion Summary</h3>
                        <div class="step-summary-list">
                            ${steps.map(s => `
                                <div class="step-item ${s.done ? 'completed' : ''}">
                                    <span style="font-size: 14px; font-weight: 500;">${s.name}</span>
                                    <span class="step-badge ${s.done ? 'done' : 'pending'}">${s.done ? 'Completed' : 'Pending'}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="card">
                        <h3 style="margin-bottom: 16px;">B) Artifact Collection</h3>
                        <div class="artifact-group">
                            <label class="input-label">Lovable Project Link</label>
                            <input type="text" value="${state.artifacts.lovable}" 
                                class="artifact-input ${state.artifacts.lovable && !validateUrl(state.artifacts.lovable) ? 'invalid' : ''}" 
                                placeholder="https://lovable.dev/projects/..." 
                                oninput="updateArtifact('lovable', this.value)">
                            <div class="form-help">Link to your Lovable project workspace.</div>
                        </div>

                        <div class="artifact-group">
                            <label class="input-label">GitHub Repository Link</label>
                            <input type="text" value="${state.artifacts.github}" 
                                class="artifact-input ${state.artifacts.github && !validateUrl(state.artifacts.github) ? 'invalid' : ''}" 
                                placeholder="https://github.com/..." 
                                oninput="updateArtifact('github', this.value)">
                            <div class="form-help">Link to the source code repository.</div>
                        </div>

                        <div class="artifact-group">
                            <label class="input-label">Live Deployment URL</label>
                            <input type="text" value="${state.artifacts.live}" 
                                class="artifact-input ${state.artifacts.live && !validateUrl(state.artifacts.live) ? 'invalid' : ''}" 
                                placeholder="https://job-tracker-demo.vercel.app" 
                                oninput="updateArtifact('live', this.value)">
                            <div class="form-help">Publicly accessible production URL.</div>
                        </div>

                        <div style="margin-top: 32px; border-top: 1px solid var(--color-border); padding-top: 24px;">
                            <button class="btn btn-primary" onclick="copySubmission()">
                                <i class="far fa-copy"></i> Copy Final Submission
                            </button>
                        </div>

                        <div id="export-container" style="display: none;">
                            <div class="export-box" id="submission-text"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateArtifact(key, value) {
            state.artifacts[key] = value.trim();
            localStorage.setItem('jobTrackerArtifacts', JSON.stringify(state.artifacts));

            // Re-render only inputs/status to avoid losing focus if complicated, but since we are simple:
            renderProofPage();
        }

        function copySubmission() {
            const art = state.artifacts;
            const text = `Job Notification Tracker — Final Submission\n\nLovable Project:\n${art.lovable || '[Not Provided]'}\n\nGitHub Repository:\n${art.github || '[Not Provided]'}\n\nLive Deployment:\n${art.live || '[Not Provided]'}\n\nCore Features:\n- Intelligent match scoring\n- Daily digest simulation\n- Status tracking\n- Test checklist enforced`;

            navigator.clipboard.writeText(text).then(() => {
                showToast("Submission copied to clipboard.");
                const container = document.getElementById('export-container');
                const box = document.getElementById('submission-text');
                box.innerText = text;
                container.style.display = 'block';
            });
        }

        // --- CHECKLIST ENGINE ---
        const TEST_ITEMS = [
            { id: 0, title: "Preferences persist after refresh", tip: "Update settings, refresh, and check if values are still there." },
            { id: 1, title: "Match score calculates correctly", tip: "Ensure scores appearing on cards match your role keywords." },
            { id: 2, title: '"Show only matches" toggle works', tip: "Toggle it and confirm the list filters items under threshold." },
            { id: 3, title: "Save job persists after refresh", tip: "Save a job, refresh, and check the 'Saved' page." },
            { id: 4, title: "Apply opens in new tab", tip: "Click Apply and check if a new tab is launched." },
            { id: 5, title: "Status update persists after refresh", tip: "Change a status to 'Applied', refresh, and verify badge color." },
            { id: 6, title: "Status filter works correctly", tip: "Filter by 'Applied' and ensure correct jobs are isolated." },
            { id: 7, title: "Digest generates top 10 by score", tip: "Generate digest and verify orders are by match score desc." },
            { id: 8, title: "Digest persists for the day", tip: "Generate digest, refresh, and verify it's still rendered." },
            { id: 9, title: "No console errors on main pages", tip: "Open DevTools and ensure no red error logs appear." }
        ];

        function renderChecklist() {
            const root = document.getElementById('checklist-root');
            if (!root) return;

            const passCount = getPassCount();
            const allPassed = passCount === 10;

            root.innerHTML = `
                <div class="checklist-container">
                    <div class="test-summary-banner ${allPassed ? 'banner-success' : 'banner-warning'}">
                        <div>
                            <h2 style="margin: 0;">Tests Passed: ${passCount} / 10</h2>
                            <p style="margin: 4px 0 0 0;">${allPassed ? 'System integrity verified. Ready for ship.' : 'Resolve all issues before shipping.'}</p>
                        </div>
                        <button class="btn" style="border: 1px solid var(--color-border); background: white;" onclick="resetTests()">Reset Status</button>
                    </div>

                    <div class="checklist-items">
                        ${TEST_ITEMS.map(item => `
                            <div class="checklist-item">
                                <input type="checkbox" ${state.testChecks[item.id] ? 'checked' : ''} onchange="toggleTest(${item.id}, this.checked)">
                                <div class="checklist-content">
                                    <div class="checklist-title">
                                        ${item.title}
                                        <i class="fas fa-info-circle test-tooltip" title="${item.tip}"></i>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function toggleTest(id, val) {
            state.testChecks[id] = val;
            localStorage.setItem('jobTrackerTestChecks', JSON.stringify(state.testChecks));
            renderChecklist();
            showToast(val ? "Test passed" : "Test unchecked");

            // If all passed, unlock Ship
            if (getPassCount() === 10) {
                showToast("All tests passed! Ship mode unlocked.");
            }
        }

        function resetTests() {
            if (confirm("Reset all test verification status?")) {
                state.testChecks = Array(10).fill(false);
                localStorage.setItem('jobTrackerTestChecks', JSON.stringify(state.testChecks));
                renderChecklist();
                showToast("Test status reset.");
            }
        }

        function renderShipPage() {
            const root = document.getElementById('ship-root');
            if (!root) return;

            const passCount = getPassCount();
            const status = getProjectStatus();
            const allPassed = passCount === 10;
            const hasLinks = state.artifacts.lovable && state.artifacts.github && state.artifacts.live;

            if (status !== 'Shipped') {
                root.innerHTML = `
                    <div class="lock-screen">
                        <i class="fas fa-lock lock-icon"></i>
                        <h1>Shipment Locked</h1>
                        <p class="subtext" style="max-width: 500px; margin: 0 auto 24px;">
                            Project 1 is currently <b>${status}</b>. To unlock shipment, you must complete all 10 integrity tests and provide all 3 required project artifacts.
                        </p>
                        <div style="display: flex; justify-content: center; gap: 16px;">
                            <a href="#/jt/07-test" class="btn">Checklist (${passCount}/10)</a>
                            <a href="#/jt/proof" class="btn btn-primary">Provide Links</a>
                        </div>
                    </div>
                `;
            } else {
                root.innerHTML = `
                    <div class="ship-success-screen">
                        <i class="fas fa-check-circle success-icon"></i>
                        <h1 style="color: #2f855a;">Project 1 Shipped Successfully.</h1>
                        <p class="subtext" style="max-width: 600px; margin: 0 auto 32px;">
                            Quality protocols verified. Artifacts documented. Deployment authorized.
                        </p>
                        <div class="card" style="text-align: left; max-width: 500px; margin: 0 auto;">
                            <h3 style="margin-bottom: 12px;">Shipment Manifest</h3>
                            <div style="font-family: monospace; font-size: 13px;">
                                <div>[PROJECT] Job Notification Tracker</div>
                                <div>[VERSION] v1.5.0-final</div>
                                <div>[QA_STATUS] 10/10 Passed</div>
                                <div>[DOCUMENTATION] Verified</div>
                                <div style="margin-top: 12px; color: var(--color-accent);">[HASH] ${Math.random().toString(36).substring(2, 10).toUpperCase()}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        window.addEventListener('hashchange', handleRouting);
        window.addEventListener('DOMContentLoaded', () => {
            handleRouting();
        });

        document.getElementById('menu-toggle').addEventListener('click', () => {
            document.getElementById('nav-links').classList.toggle('show');
        });

        // Close modal on click outside
        window.onclick = function (event) {
            const modal = document.getElementById('job-modal');
            if (event.target == modal) closeModal();
        }
    </script>

</body>

</html>